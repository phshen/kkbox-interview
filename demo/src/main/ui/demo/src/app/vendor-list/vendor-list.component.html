<h1 class="title-layout">廠商資料表</h1>
<div class="vendor-list">
  <div>
    <h2 class="section-layout">已儲存廠商</h2>
    <br>
    <table mat-table #vendorListTable [dataSource]="vendors" class="mat-elevation-z8 section-layout">
      <!-- name -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>公司名稱</th>
        <td mat-cell *matCellDef="let element"> {{element.name}} </td>
      </ng-container>

      <!-- company id -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>統一編號</th>
        <td mat-cell *matCellDef="let element"> {{element.id}} </td>
      </ng-container>

      <!-- phone number -->
      <ng-container matColumnDef="tel">
        <th mat-header-cell *matHeaderCellDef>電話</th>
        <td mat-cell *matCellDef="let element"> {{element.tel}} </td>
      </ng-container>

      <!-- email -->
      <ng-container matColumnDef="applicant">
        <th mat-header-cell *matHeaderCellDef>填單人</th>
        <td mat-cell *matCellDef="let element"> {{element.applicant}} </td>
      </ng-container>

      <!-- update time -->
      <ng-container matColumnDef="updateTime">
        <th mat-header-cell *matHeaderCellDef>更新時間</th>
        <td mat-cell *matCellDef="let element"> {{element.updateTime}} </td>
      </ng-container>

      <!-- Action Column -->
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef class="action-col-width">刪除/修改</th>
        <td mat-cell *matCellDef="let element; let i = index" class="action-col-width">
          <button mat-flat-button color="warn" (click)="deleteVendor(element, i)" class="action-button">Delete</button>
          <button mat-flat-button color="primary" (click)="showEditData(element, i)" class="action-button">Edit</button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumnsForList"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumnsForList;"></tr>
    </table>
  </div>
</div>

<div class="vendor-info">
  <form #vendorForm="ngForm">
    <!-- vendor info -->
    <h2 class="form-section-header">廠商基本資料</h2>
    <table class="section-layout">
        <tr>
          <td><span class="required-field">*</span>填單人</td>
          <td>
          <mat-form-field appearance="outline">
            <input matInput type="text" [(ngModel)]="vendor.applicant"
            class="form-control"
            id="applicant"
            name="applicant"
            placeholder="請輸入姓名"
            required #applicant="ngModel">
            <mat-error *ngIf="applicant.invalid">填單人為必填欄位</mat-error>
          </mat-form-field>
          </td>

          <td><span class="required-field">*</span>公司名稱</td>
          <td>
            <mat-form-field appearance="outline">
            <!-- <mat-label for="name">公司名稱</mat-label> -->
            <input matInput type="text" [(ngModel)]="vendor.name"
            class="form-control"
            id="name"
            name="name"s
            placeholder="請輸入公司名稱"
            required #name="ngModel" [disabled]="editAction">
            <mat-error *ngIf="name.invalid">公司名稱為必填欄位</mat-error>
          </mat-form-field>
          </td>
        </tr>
      <tr>
        <td><span class="required-field">*</span>統一編號</td>
        <td>
        <mat-form-field appearance="outline">
          <input matInput type="text" [(ngModel)]="vendor.id" companyIdValidator="vendor.id"
          class="form-control"
          id="id"
          name="id"
          placeholder="請輸入統一編號"
          required #id="ngModel" [disabled]="editAction">
          <mat-error *ngIf="id.errors && id.errors.required">統一編號為必填欄位</mat-error>
          <mat-error *ngIf="id.errors && !id.errors.required && id.errors.companyId">統一編號須為八位數字</mat-error>
        </mat-form-field>
        <!-- <div *ngIf = "id.invalid && (id.dirty || id.touched)" class="alert alert-danger">
            <mat-error *ngIf="id.errors && id.errors.required">統一編號為必填欄位</mat-error>
            <mat-error *ngIf="id.errors && !id.errors.required && id.errors.companyId">統一編號須為八位數字</mat-error>
        </div> -->
        </td>
        <td><span class="required-field">*</span>負責人</td>
        <td>
        <mat-form-field appearance="outline">
          <input matInput type="text" [(ngModel)]="vendor.owner"
          class="form-control"
          id="owner"
          name="owner"
          placeholder="請輸入姓名"
          required #owner="ngModel">
          <mat-error *ngIf="owner.invalid">負責人為必填欄位</mat-error>
        </mat-form-field>
        </td>
      </tr>
      <tr>
        <td><span class="required-field">*</span>地址</td>
        <td colspan="3">
        <mat-form-field appearance="outline" class="address-field-width">
          <input matInput type="text" [(ngModel)]="vendor.address"
          class="form-control"
          id="address"
          name="address"
          placeholder="請輸入公司地址"
          required #address="ngModel">
          <mat-error *ngIf="address.invalid">地址為必填欄位</mat-error>
        </mat-form-field>
        </td>
      </tr>
      <tr>
        <td>電話</td>
        <td>
        <mat-form-field appearance="outline">
          <input matInput [(ngModel)]="vendor.tel" telValidator="vendor.tel"
          class="form-control"
          id="tel"
          name="tel"
          type="text"
          placeholder="ex: 02-12345678"
          #tel="ngModel">
          <mat-error *ngIf="tel.value && tel.errors && tel.errors.telNumber">電話格式錯誤</mat-error>
        </mat-form-field>

        </td>
        <td>傳真</td>
        <td>
        <mat-form-field appearance="outline">
          <input matInput type="text" [(ngModel)]="vendor.fax"
          class="form-control"
          id="fax"
          name="fax"
          type="number"
          #fax="ngModel">
        </mat-form-field>
        </td>
      </tr>
      <tr>
        <td>備註</td>
        <td>
        <mat-form-field appearance="outline">
          <input matInput type="text" [(ngModel)]="vendor.remark"
          class="form-control"
          id="remark"
          name="remark"
          #remark="ngModel">
        </mat-form-field>
        </td>
      </tr>
    </table>

    <!-- contact info -->
    <div>
      <h2 class="form-section-header"><span class="required-field">*</span>聯絡人</h2>
      <table mat-table #contactsTable [dataSource]="contacts" class="mat-elevation-z8 section-layout">

        <!-- name -->
        <ng-container matColumnDef="contactPerson">
          <th mat-header-cell *matHeaderCellDef><span class="required-field">*</span>姓名</th>
          <td mat-cell *matCellDef="let element; let i = index">
            {{element.contactPerson}}
          </td>
        </ng-container>

        <!-- job title -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef><span class="required-field">*</span>職稱</th>
          <td mat-cell *matCellDef="let element">
            {{element.title}}
          </td>
        </ng-container>

        <!-- phone number -->
        <ng-container matColumnDef="contactNumber">
          <th mat-header-cell *matHeaderCellDef>電話</th>
          <td mat-cell *matCellDef="let element">
            {{element.contactNumber}}
          </td>
        </ng-container>

        <!-- email -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let element">
            {{element.email}}
          </td>
        </ng-container>

        <!-- Action Column -->
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef class="action-col-width">新增/刪除/修改</th>
          <td mat-cell *matCellDef="let element; let i = index" class="action-link">
            <a mat-flat-button color="primary" (click)="openDialog('Add', element, i)" *ngIf="i == contacts.length-1" class="action-button">Add</a>
            <a mat-flat-button color="accent" (click)="openDialog('Edit', element, i)" *ngIf="i != contacts.length-1" class="action-button">Edit</a>
            <a mat-flat-button color="warn" (click)="openDialog('Delete', element, i)" *ngIf="i != contacts.length-1" class="action-button">Delete</a>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>
    <br>
    <br>
    <div class="form-action">
      <button mat-raised-button color="primary" type="submit" (click)="onSubmit(); vendorForm.reset()" [disabled]="!vendorForm.form.valid || contacts.length == 1">儲存</button>
      <a mat-raised-button color="accent" (click)="vendorForm.reset();resetContacts()">清空重填</a>
    </div>
  </form>
</div>
<footer class="footer"></footer>
